<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title class="jsx-2893578415">01factory|01微工厂</title><meta name="keywords" content="01factory,dfactory,01" class="jsx-2893578415"/><meta name="description" content="微工厂,从零到壹，数字之道" class="jsx-2893578415"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" class="jsx-2893578415"/><link rel="icon" type="image/x-icon" sizes="32x32" href="/favicon-32x32.ico" class="jsx-2893578415"/><link rel="icon" type="image/x-icon" sizes="16x16" href="/favicon-16x16.ico" class="jsx-2893578415"/><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/93e6942230e38e95adce.css" as="style"/><link rel="stylesheet" href="/_next/static/css/93e6942230e38e95adce.css" data-n-g=""/><link rel="preload" href="/_next/static/css/15ba1ee3e59766b2d5b0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/15ba1ee3e59766b2d5b0.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-3ce0bb09ea8ab3ae9efe.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.0c239260661ae1d12aa2.js" as="script"/><link rel="preload" href="/_next/static/chunks/4cae35f392ad8d1773981d3dc08be1651c0c49e2.9b340f9d21cfc83997ce.js" as="script"/><link rel="preload" href="/_next/static/chunks/3703c918adce6ba21154be49aaba688659a8d38f.ad5c533b8e6aa4978bfb.js" as="script"/><link rel="preload" href="/_next/static/chunks/f20a06aab33eefd0ae2fde6959b255b94722e7c2.65571f932be9853a08b3.js" as="script"/><link rel="preload" href="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.e74eb3fb4984ff137a52.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-685b4c3f8ffc83e903ae.js" as="script"/><link rel="preload" href="/_next/static/chunks/149a5bbbf9cefa6e704d31c699b7ae5125b7d027.134529ea440b13f2ddd4.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/documents/2021/05/01/1537-e5709e7f2fb6fa882892.js" as="script"/></head><body><div id="__next"><div class="jsx-86683480 row "><div class="jsx-180329529 col s002"><div class="jsx-2893578415 outer"><header class="jsx-2893578415 inner"><a class="jsx-2893578415" href="/"><img height="150" width="217" src="/images/logo.png" class="jsx-2893578415 s001"/></a></header></div></div></div><div class="jsx-86683480 row "><div class="jsx-158700623 col "><a class="jsx-2893578415" href="/home_design"><h2 class="jsx-244854117  ">方案文档</h2></a></div><div class="jsx-158700623 col "><a class="jsx-2893578415" href="/"><h2 class="jsx-244854117  ">开发文档</h2></a></div><div class="jsx-158700623 col "><a class="jsx-2893578415" href="/home_ops"><h2 class="jsx-244854117  ">运维文档</h2></a></div></div><div class="jsx-788945023"><h1>获取客户端ip</h1><div class="jsx-2207282366 row "><div class="jsx-158700623 col "><button type="button" class="jsx-1464210458 btn "><div class="text">Reset</div></button><button type="button" class="jsx-1464210458 btn "><div class="text">Copy</div></button></div></div><div class="jsx-86683480 row "><div class="jsx-180329529 col "><div class="jsx-1629357098"><div style="position:relative;text-align:left;box-sizing:border-box;padding:0;overflow:hidden;font-family:&quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;font-size:12px"><textarea style="margin:0;border:0;background:none;box-sizing:inherit;display:inherit;font-family:inherit;font-size:inherit;font-style:inherit;font-variant-ligatures:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;tab-size:inherit;text-indent:inherit;text-rendering:inherit;text-transform:inherit;white-space:pre-wrap;word-break:keep-all;overflow-wrap:break-word;position:absolute;top:0;left:0;height:100%;width:100%;resize:none;color:inherit;overflow:hidden;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;-webkit-text-fill-color:transparent;padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px" class="npm__react-simple-code-editor__textarea" autoCapitalize="off" autoComplete="off" autoCorrect="off" spellcheck="false" data-gramm="false">const headers = req.headers;
	const ip = headers[&#x27;x-real-ip&#x27;] as string || headers[&#x27;x-forwarded-for&#x27;] as string || // 判断是否有反向代理 IP
		req.connection.remoteAddress || // 判断 connection 的远程 IP
		req.socket.remoteAddress; // 判断后端的 socket 的 IP</textarea><pre aria-hidden="true" style="margin:0;border:0;background:none;box-sizing:inherit;display:inherit;font-family:inherit;font-size:inherit;font-style:inherit;font-variant-ligatures:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;tab-size:inherit;text-indent:inherit;text-rendering:inherit;text-transform:inherit;white-space:pre-wrap;word-break:keep-all;overflow-wrap:break-word;position:relative;pointer-events:none;padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px"><span class="token keyword">const</span> headers <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">;</span>
	<span class="token keyword">const</span> ip <span class="token operator">=</span> headers<span class="token punctuation">[</span><span class="token string">'x-real-ip'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token builtin">string</span> <span class="token operator">||</span> headers<span class="token punctuation">[</span><span class="token string">'x-forwarded-for'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token builtin">string</span> <span class="token operator">||</span> <span class="token comment">// 判断是否有反向代理 IP</span>
		req<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>remoteAddress <span class="token operator">||</span> <span class="token comment">// 判断 connection 的远程 IP</span>
		req<span class="token punctuation">.</span>socket<span class="token punctuation">.</span>remoteAddress<span class="token punctuation">;</span> <span class="token comment">// 判断后端的 socket 的 IP</span><br /></pre><style type="text/css">
/**
 * Reset the text fill color so that placeholder is visible
 */
.npm__react-simple-code-editor__textarea:empty {
  -webkit-text-fill-color: inherit !important;
}

/**
 * Hack to apply on some CSS on IE10 and IE11
 */
@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {
  /**
    * IE doesn't support '-webkit-text-fill-color'
    * So we use 'color: transparent' to make the text transparent on IE
    * Unlike other browsers, it doesn't affect caret color in IE
    */
  .npm__react-simple-code-editor__textarea {
    color: transparent !important;
  }

  .npm__react-simple-code-editor__textarea::selection {
    background-color: #accef7 !important;
    color: transparent !important;
  }
}
</style></div></div></div></div></div><div class="jsx-1988653958 outer"><footer class="jsx-1988653958 inner"><a href="https://github.com/01factory/01factory.github.io/edit/main/src/pages/main.md" target="_blank" rel="noreferrer noopener" class="jsx-1988653958"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" class="jsx-1988653958 s001"><g class="jsx-1988653958"><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z" class="jsx-1988653958"></path></g></svg>Edit this page on Github</a><br class="jsx-1988653958"/><a href="https://gitee.com/dfactory01/dfactory01/edit/main/src/pages/main.md" target="_blank" rel="noreferrer noopener" class="jsx-1988653958"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" class="jsx-1988653958 s001"><g class="jsx-1988653958"><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z" class="jsx-1988653958"></path></g></svg>Edit this page on Gitee</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/documents/2021/05/01/1537","query":{},"buildId":"3XUIaxAEdK_rV8MJOekb4","runtimeConfig":{},"nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-4ecda70c525e82214a3b.js"></script><script src="/_next/static/chunks/main-3ce0bb09ea8ab3ae9efe.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.0c239260661ae1d12aa2.js" async=""></script><script src="/_next/static/chunks/4cae35f392ad8d1773981d3dc08be1651c0c49e2.9b340f9d21cfc83997ce.js" async=""></script><script src="/_next/static/chunks/3703c918adce6ba21154be49aaba688659a8d38f.ad5c533b8e6aa4978bfb.js" async=""></script><script src="/_next/static/chunks/f20a06aab33eefd0ae2fde6959b255b94722e7c2.65571f932be9853a08b3.js" async=""></script><script src="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.e74eb3fb4984ff137a52.js" async=""></script><script src="/_next/static/chunks/pages/_app-685b4c3f8ffc83e903ae.js" async=""></script><script src="/_next/static/chunks/149a5bbbf9cefa6e704d31c699b7ae5125b7d027.134529ea440b13f2ddd4.js" async=""></script><script src="/_next/static/chunks/pages/documents/2021/05/01/1537-e5709e7f2fb6fa882892.js" async=""></script><script src="/_next/static/3XUIaxAEdK_rV8MJOekb4/_buildManifest.js" async=""></script><script src="/_next/static/3XUIaxAEdK_rV8MJOekb4/_ssgManifest.js" async=""></script></body></html>