<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title class="jsx-2893578415">01factory|01微工厂</title><meta name="keywords" content="01factory,dfactory,01" class="jsx-2893578415"/><meta name="description" content="微工厂,从零到壹，数字之道" class="jsx-2893578415"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" class="jsx-2893578415"/><link rel="icon" type="image/x-icon" sizes="32x32" href="/favicon-32x32.ico" class="jsx-2893578415"/><link rel="icon" type="image/x-icon" sizes="16x16" href="/favicon-16x16.ico" class="jsx-2893578415"/><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/350e09057e231801b32f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/350e09057e231801b32f.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.f8bd46fc02868c500bda.js" as="script"/><link rel="preload" href="/_next/static/chunks/d59dcf7f32a245abc64a6405ef1dce9161f1a8bf.65571f932be9853a08b3.js" as="script"/><link rel="preload" href="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.7f522d4c44240e733215.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-99016dfb960f134c798a.js" as="script"/><link rel="preload" href="/_next/static/chunks/97441fe2b503c77439bc39e0ef50bbe5e8642838.9b340f9d21cfc83997ce.js" as="script"/><link rel="preload" href="/_next/static/chunks/d006a03c77e1b24ad06b238024f496d74bbfc1db.73d35c9d2664c8d142ad.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-7467674471030778f3eb.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/documents/2021/03/101533-52f1ca50b78c75627388.js" as="script"/></head><body><div id="__next"><div class="jsx-86683480 row "><div class="jsx-180329529 col s002"><div class="jsx-2893578415 outer"><header class="jsx-2893578415 inner"><a class="jsx-2893578415" href="/"><img height="150" width="217" src="/images/logo.png" class="jsx-2893578415 s001"/></a></header></div></div></div><div class="jsx-86683480 row "><div class="jsx-158700623 col "><a class="jsx-2893578415" href="/home_design"><h2 class="jsx-244854117  ">方案文档</h2></a></div><div class="jsx-158700623 col "><a class="jsx-2893578415" href="/"><h2 class="jsx-244854117  ">开发文档</h2></a></div><div class="jsx-158700623 col "><a class="jsx-2893578415" href="/home_ops"><h2 class="jsx-244854117  ">运维文档</h2></a></div></div><div class="jsx-788945023"><h1>sql基础及应用</h1><h2>准备</h2><p>选用任一款数据库工具，连上数据库。</p><h2>数据操作（准备）</h2><ol><li><p>创建表</p><p>使用以下脚本创建表</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> star<span class="token punctuation">(</span>
    _id <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    name <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    sex <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">with</span> <span class="token punctuation">(</span>
    oids<span class="token operator">=</span><span class="token boolean">false</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>执行这段脚本，现在应该就会看到有一个表，名字叫<code>star</code>，即为我们刚才创建的一个表。</p></li><li><p>插入一条数据记录</p><p>使用以下脚本添加一条数据记录：</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> star<span class="token punctuation">(</span>_id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">&#x27;1&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;John&#x27;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li><li><p>删除数据记录</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">delete</span> <span class="token keyword">from</span> star <span class="token keyword">as</span> t1 <span class="token keyword">where</span> t1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#x27;John&#x27;</span><span class="token punctuation">;</span>
</code></pre></li><li><p>删除表</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> star<span class="token punctuation">;</span>
</code></pre><p>刚才创建的表已经没有了。</p></li><li><p>插入一些必要的测试数据。</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> star<span class="token punctuation">(</span>
    _id <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    name <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    sex <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">with</span> <span class="token punctuation">(</span>
    oids<span class="token operator">=</span><span class="token boolean">false</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> star<span class="token punctuation">(</span>_id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">&#x27;1&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;john&#x27;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&#x27;2&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;jack&#x27;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&#x27;3&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;jean&#x27;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> fruit_price <span class="token punctuation">(</span>
    _id <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    name <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    price <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">with</span> <span class="token punctuation">(</span>
    oids<span class="token operator">=</span><span class="token boolean">false</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> fruit_price<span class="token punctuation">(</span>_id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> price<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">&#x27;1&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;apple&#x27;</span><span class="token punctuation">,</span> <span class="token number">1.00</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&#x27;2&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;banana&#x27;</span><span class="token punctuation">,</span> <span class="token number">3.00</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&#x27;3&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;tomato&#x27;</span><span class="token punctuation">,</span> <span class="token number">0.00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> star_hobby <span class="token punctuation">(</span>
    _id <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    star <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    hobby <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token punctuation">)</span> <span class="token keyword">with</span> <span class="token punctuation">(</span>
    oids<span class="token operator">=</span><span class="token boolean">false</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> star_hobby<span class="token punctuation">(</span>_id<span class="token punctuation">,</span> star<span class="token punctuation">,</span> hobby<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">&#x27;1&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;1&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;eat, drink, smoke&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&#x27;2&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;2&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;sleep&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&#x27;3&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;3&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;eat, drink, smoke, sleep&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> star_works <span class="token punctuation">(</span>
    _id <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    star <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    works <span class="token keyword">character</span> <span class="token keyword">varying</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token punctuation">)</span> <span class="token keyword">with</span> <span class="token punctuation">(</span>
    oids<span class="token operator">=</span><span class="token boolean">false</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> star_works<span class="token punctuation">(</span>_id<span class="token punctuation">,</span> star<span class="token punctuation">,</span> works<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">&#x27;1&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;1&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;smoke in the night&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&#x27;2&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;2&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;sleep in the day&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&#x27;3&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;3&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;smoke and sleep day and night&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li></ol><h2>数据插入</h2><p>上面已经提到了一些简单的数据操作，现在我们来进行sql的进一步操作介绍</p><ol><li><p>增加数据（单条记录）</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> star <span class="token punctuation">(</span>_id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&#x27;0ea5&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;悟能&#x27;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> fruit_price <span class="token punctuation">(</span>_id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> price<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&#x27;4&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;番茄&#x27;</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> star_hobby<span class="token punctuation">(</span>_id<span class="token punctuation">,</span> star<span class="token punctuation">,</span> hobby<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&#x27;4&#x27;</span><span class="token punctuation">,</span><span class="token string">&#x27;0ea5&#x27;</span><span class="token punctuation">,</span><span class="token string">&#x27;吃和睡&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li><li><p>增加数据（多条记录）</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> star_works<span class="token punctuation">(</span>_id<span class="token punctuation">,</span> star<span class="token punctuation">,</span> works<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&#x27;4&#x27;</span><span class="token punctuation">,</span><span class="token string">&#x27;0ea5&#x27;</span><span class="token punctuation">,</span><span class="token string">&#x27;九吃钉耙&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&#x27;5&#x27;</span><span class="token punctuation">,</span><span class="token string">&#x27;0ea5&#x27;</span><span class="token punctuation">,</span><span class="token string">&#x27;嫦娥仙子&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li></ol><h2>数据编辑</h2><p>比如在我们初始化的数据中，有一个明星名字叫<code>jean</code>的，她的姓名为男，我们发现了这个错误，所以我们要将名字为<code>jean</code>的这条数据的性别<code>sex</code>修改为女（0）</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">update</span> star <span class="token keyword">set</span> sex <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#x27;jean&#x27;</span><span class="token punctuation">;</span>
</code></pre><h2>简单查询</h2><ol><li><p>简单查询</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> _id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> price <span class="token keyword">from</span> fruit_price <span class="token keyword">as</span> t1<span class="token punctuation">;</span>
</code></pre></li><li><p>别名</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>_id <span class="token keyword">as</span> id<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>name <span class="token keyword">as</span> fruit_name<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>price <span class="token keyword">as</span> fruit_price <span class="token keyword">from</span> fruit_price <span class="token keyword">as</span> t1<span class="token punctuation">;</span>
</code></pre><p>使用别名是一个好习惯,特别是多表查询的时候.</p></li><li><p>带排序的查询</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>_id <span class="token keyword">as</span> id<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>name <span class="token keyword">as</span> fruit_name<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>price <span class="token keyword">as</span> fruit_price <span class="token keyword">from</span> fruit_price <span class="token keyword">as</span> t1 <span class="token keyword">order</span> <span class="token keyword">by</span> t1<span class="token punctuation">.</span>price<span class="token punctuation">;</span>
</code></pre></li></ol><table><thead><tr><th>id</th><th>fruit_name</th><th>fruit_price</th></tr></thead><tbody><tr><td>&quot;3&quot;</td><td>&quot;tomato&quot;</td><td>0.00</td></tr><tr><td>&quot;4&quot;</td><td>&quot;番茄&quot;</td><td>0.50</td></tr><tr><td>&quot;1&quot;</td><td>&quot;apple&quot;</td><td>1.00</td></tr><tr><td>&quot;2&quot;</td><td>&quot;banana&quot;</td><td>3.00</td></tr></tbody></table><p>注意： <code>order by</code>默认为升序(<code>asc</code>)，如果要使用降序排序，要使用<code>desc</code>：</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>_id <span class="token keyword">as</span> id<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>name <span class="token keyword">as</span> fruit_name<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>price <span class="token keyword">as</span> fruit_price <span class="token keyword">from</span> fruit_price <span class="token keyword">as</span> t1 <span class="token keyword">order</span> <span class="token keyword">by</span> t1<span class="token punctuation">.</span>price <span class="token keyword">desc</span><span class="token punctuation">;</span>
</code></pre><table><thead><tr><th>id</th><th>fruit_name</th><th>fruit_price</th></tr></thead><tbody><tr><td>&quot;2&quot;</td><td>&quot;banana&quot;</td><td>3.00</td></tr><tr><td>&quot;1&quot;</td><td>&quot;apple&quot;</td><td>1.00</td></tr><tr><td>&quot;4&quot;</td><td>&quot;番茄&quot;</td><td>0.50</td></tr><tr><td>&quot;3&quot;</td><td>&quot;tomato&quot;</td><td>0.00</td></tr></tbody></table><h2>分页查询</h2><p>因为我们现在的测试数据不够多，所以我们假定一页只显示2条数据(page_size=2)，当前为第二页(page_no=2).这时我们要用到两个postgre数据库中两个关键字：<code>limit</code>和<code>offset</code>。</p><h3><code>limit</code></h3><p>表示最多返回多少条数据记录，后面一般跟一个正整数。我们这里应该为2</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>_id <span class="token keyword">as</span> id<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>name <span class="token keyword">as</span> fruit_name<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>price <span class="token keyword">as</span> fruit_price <span class="token keyword">from</span> fruit_price <span class="token keyword">as</span> t1 <span class="token keyword">order</span> <span class="token keyword">by</span> t1<span class="token punctuation">.</span>price <span class="token keyword">limit</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre><p>以上脚本执行的结果为:</p><table><thead><tr><th>id</th><th>fruit_name</th><th>fruit_price</th></tr></thead><tbody><tr><td>&quot;3&quot;</td><td>&quot;tomato&quot;</td><td>0.00</td></tr><tr><td>&quot;4&quot;</td><td>&quot;番茄&quot;</td><td>0.50</td></tr></tbody></table><h3><code>offset</code></h3><p>表示返回数据时从前面后偏移多少条记录。我们对上面的查询添加上offset参数之后</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>_id <span class="token keyword">as</span> id<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>name <span class="token keyword">as</span> fruit_name<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>price <span class="token keyword">as</span> fruit_price <span class="token keyword">from</span> fruit_price <span class="token keyword">as</span> t1 <span class="token keyword">order</span> <span class="token keyword">by</span> t1<span class="token punctuation">.</span>price <span class="token keyword">offset</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre><p>查询出来的结果为：</p><table><thead><tr><th>id</th><th>fruit_name</th><th>fruit_price</th></tr></thead><tbody><tr><td>&quot;1&quot;</td><td>&quot;apple&quot;</td><td>1.00</td></tr><tr><td>&quot;2&quot;</td><td>&quot;banana&quot;</td><td>3.00</td></tr></tbody></table><h3>分页</h3><p>从上面的解释中不难看出，我们如果想查询出来第2页（每页2条数据），<code>limit</code>的值应为<code>2</code>，即<code>page_size</code>的值。而<code>offset</code>应为多少呢，它的计算公式应为</p><pre class="language-sql"><code class="language-sql"><span class="token punctuation">(</span>page_no <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">*</span> page_size
</code></pre><p>将参数代入以上公式，即可得出<code>offset</code>的值为(2 - 1) * 2 = 2;</p><p>所以我们要进行的查询的sql如下:</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>_id <span class="token keyword">as</span> id<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>name <span class="token keyword">as</span> fruit_name<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>price <span class="token keyword">as</span> fruit_price <span class="token keyword">from</span> fruit_price <span class="token keyword">as</span> t1 <span class="token keyword">order</span> <span class="token keyword">by</span> t1<span class="token punctuation">.</span>price <span class="token keyword">limit</span> <span class="token number">2</span> <span class="token keyword">offset</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre><h2>函数</h2><p>我们通常用的函数有<code>count</code>,<code>sum</code>,<code>avg</code>,<code>max</code>,<code>min</code>.</p><p>比如我们通常用的获取数据记录的总数，可以使用以语句：</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> fruit_price <span class="token keyword">as</span> t1<span class="token punctuation">;</span>
</code></pre><p>其它几个函数使用方法与<code>count</code>类似，有些在具体使用时甚至要搭配<code>group by</code>。这里先不介绍了。</p><h2>唯一值</h2><p>有时候我们可能希望过滤掉某个表里的重复的值，比如我们要查一下作品表star_works中不重复的明星的唯一标识(star)们。</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token keyword">distinct</span> t1<span class="token punctuation">.</span>star <span class="token keyword">as</span> star_id <span class="token keyword">from</span> star_works <span class="token keyword">as</span> t1<span class="token punctuation">;</span>
</code></pre><p>甚至计算一下它的数据总条数。</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> t1<span class="token punctuation">.</span>star<span class="token punctuation">)</span> <span class="token keyword">as</span> stars <span class="token keyword">from</span> star_works <span class="token keyword">as</span> t1<span class="token punctuation">;</span>
</code></pre><h2>子查询</h2><p>子查询就是将查询出来的结果当作另外的一条表再次使用它进行查询，一般前面会跟<code>in</code>关键字。</p><p>比如我们想查询所有男明星的作品</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>works <span class="token keyword">as</span> 作品 <span class="token keyword">from</span> star_works t1 <span class="token keyword">where</span> t1<span class="token punctuation">.</span>star <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> t2<span class="token punctuation">.</span>_id <span class="token keyword">from</span> star <span class="token keyword">as</span> t2 <span class="token keyword">where</span> t2<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2>多表查询</h2><p>接上例，假如说我们需要同时知道明星的名字，可以使用以下查询</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>works <span class="token keyword">as</span> 作品<span class="token punctuation">,</span> t3<span class="token punctuation">.</span>name <span class="token keyword">as</span> 明星 <span class="token keyword">from</span> star_works t1<span class="token punctuation">,</span> star t3 <span class="token keyword">where</span> t1<span class="token punctuation">.</span>star <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> t2<span class="token punctuation">.</span>_id <span class="token keyword">from</span> star <span class="token keyword">as</span> t2 <span class="token keyword">where</span> t2<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">and</span> t1<span class="token punctuation">.</span>star<span class="token operator">=</span>t3<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
</code></pre><p>而事实上你可能会发现，这时我们其实可以不使用子查询了</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>works <span class="token keyword">as</span> 作品<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>name <span class="token keyword">as</span> 明星 <span class="token keyword">from</span> star_works t1<span class="token punctuation">,</span> star t2 <span class="token keyword">where</span> t2<span class="token punctuation">.</span>sex <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">and</span> t1<span class="token punctuation">.</span>star<span class="token operator">=</span>t2<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
</code></pre><p>它与上面的结果是一样的，不是吗。并且，我们从语法上分析也是对的。分析一下有到底有什么不同。</p><p>事实上，这时的多表查询其实就是一个内连接查询。下面我们会讲到。</p><h2>连接(join)</h2><p>join 子句用于把来多个表的行连接起来成为一个表（查询结果）。</p><p>为了能够将连接部分讲得更清楚一些，我们需要再添加2条数据。</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> star <span class="token punctuation">(</span>_id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&#x27;5&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;三藏&#x27;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> star_works<span class="token punctuation">(</span>_id<span class="token punctuation">,</span> star<span class="token punctuation">,</span> works<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&#x27;6&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;5&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;取经&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>这2条数据以前面的有什么不同呢？这位明星<code>三藏</code>他有作品(取经)，但是没有爱好。</p><h3>内连接(inner join)</h3><p>inner join只连接匹配的行，不匹配的结果不会在结果集中出现。</p><p>接下来我们来进行一个内连接查询</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>works <span class="token keyword">from</span> star <span class="token keyword">as</span> t1 <span class="token keyword">inner</span> <span class="token keyword">join</span> star_works t2 <span class="token keyword">on</span> t2<span class="token punctuation">.</span>star<span class="token operator">=</span>t1<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
</code></pre><p>而<code>inner</code>关键字是可以省略的</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>works <span class="token keyword">from</span> star <span class="token keyword">as</span> t1 <span class="token keyword">join</span> star_works t2 <span class="token keyword">on</span> t2<span class="token punctuation">.</span>star<span class="token operator">=</span>t1<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
</code></pre><p>细观察你可能就会发现了，这个结果其实就是我们在前面提到的多表关联查询。</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>works <span class="token keyword">from</span> star <span class="token keyword">as</span> t1<span class="token punctuation">,</span> star_works t2 <span class="token keyword">where</span> t2<span class="token punctuation">.</span>star<span class="token operator">=</span>t1<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
</code></pre><p>这时如果我们需要查询数据总条数，也是可以的</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> star <span class="token keyword">as</span> t1<span class="token punctuation">,</span> star_works t2 <span class="token keyword">where</span> t2<span class="token punctuation">.</span>star<span class="token operator">=</span>t1<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
</code></pre><p>接着我们再来查一下明星们的爱好（注意<code>三藏</code>这位明星）：</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>hobby <span class="token keyword">from</span> star <span class="token keyword">as</span> t1<span class="token punctuation">,</span> star_hobby t2 <span class="token keyword">where</span> t2<span class="token punctuation">.</span>star<span class="token operator">=</span>t1<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
</code></pre><p>仔细查询查询结果就会发现，结果中没有<code>三藏</code>这位明星相关的数据。因为<code>三藏</code>大师并没有其它的爱好，所以使用<strong>内连接</strong>的时候，查询结果里不会出现。如果想要这些数据怎么办呢？答案是使用<strong>外连接</strong>。</p><p>注意：在使用count的时候请使用count(*)而不是count(t1.name)这样的方式。它们的区别是，使用某个字段进行计数的时候，它会排除该字段为null的情况，这通常不是我们想要的，如果要排除空值，你完全可以在where条件里添加。</p><h3>外连接(outer join)</h3><h4>左外连接(left outer join)</h4><p>左连接返回左边表中的全部记录，右边表中如果没有与之关联的记录，则查询结果为<code>null</code>。</p><p>因为内连接没有能把三藏大师查出来，而我们有时候确实希望能查出来，怎么办呢？看以下语句：</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>hobby <span class="token keyword">from</span> star <span class="token keyword">as</span> t1 <span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> star_hobby t2 <span class="token keyword">on</span> t2<span class="token punctuation">.</span>star<span class="token operator">=</span>t1<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
</code></pre><p><code>outer</code>关键字可以省略</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>hobby <span class="token keyword">from</span> star <span class="token keyword">as</span> t1 <span class="token keyword">left</span> <span class="token keyword">join</span> star_hobby t2 <span class="token keyword">on</span> t2<span class="token punctuation">.</span>star<span class="token operator">=</span>t1<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
</code></pre><p>结果为</p><table><thead><tr><th>name</th><th>hobby</th></tr></thead><tbody><tr><td>&quot;john&quot;</td><td>&quot;eat, drink, smoke&quot;</td></tr><tr><td>&quot;jack&quot;</td><td>&quot;sleep&quot;</td></tr><tr><td>&quot;悟能&quot;</td><td>&quot;吃和睡&quot;</td></tr><tr><td>&quot;jean&quot;</td><td>&quot;eat, drink, smoke, sleep&quot;</td></tr><tr><td>&quot;三藏&quot;</td><td>[null]</td></tr></tbody></table><p>可以看到，上面查出来的结果当中,name为三藏这条数据的hobby字段值为<code>null</code></p><h4>右外连接(right outer join)</h4><p>右连接与左连接相反，右连接返回右边表中的全部记录，左边表中如果没有与之关联的记录，则查询结果为<code>null</code>。所以，上面左连接的例子调整一下表的次序，将<code>left</code>修改为<code>right</code>。结果完全一样。</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>hobby <span class="token keyword">from</span> star <span class="token keyword">as</span> t1 <span class="token keyword">right</span> <span class="token keyword">join</span> star_hobby t2 <span class="token keyword">on</span> t2<span class="token punctuation">.</span>star<span class="token operator">=</span>t1<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
<span class="token keyword">select</span> t1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> t2<span class="token punctuation">.</span>hobby <span class="token keyword">from</span> star <span class="token keyword">as</span> t1 <span class="token keyword">right</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> star_hobby t2 <span class="token keyword">on</span> t2<span class="token punctuation">.</span>star<span class="token operator">=</span>t1<span class="token punctuation">.</span>_id<span class="token punctuation">;</span>
</code></pre><h4>完整连接(full outer join)</h4><p>完整连接其实就是综合左连接和右连接，将两边不存在的数据也都查出来。结果显示为<code>null</code>，但是这种情形不是很常用（如果你能够掌握左连接和右连接，这种非常容易理解），不作详细介绍。</p><h2>分组(group by)</h2><p>分组是将查询的结果进行分组聚合，在一些使用场景中非常方便。</p><p>比如我们需要根据名字进行分组，统计一下明星们的作品数量。可以使用以下查询：</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>works<span class="token punctuation">)</span> <span class="token keyword">as</span> c <span class="token keyword">from</span> star <span class="token keyword">as</span> t1 <span class="token keyword">join</span> star_works t2 <span class="token keyword">on</span> t2<span class="token punctuation">.</span>star<span class="token operator">=</span>t1<span class="token punctuation">.</span>_id <span class="token keyword">group</span> <span class="token keyword">by</span> t1<span class="token punctuation">.</span>name <span class="token keyword">order</span> <span class="token keyword">by</span> c <span class="token keyword">desc</span><span class="token punctuation">;</span>
</code></pre><p>如果进行分页查询</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> t1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>works<span class="token punctuation">)</span> <span class="token keyword">as</span> c <span class="token keyword">from</span> star <span class="token keyword">as</span> t1 <span class="token keyword">join</span> star_works t2 <span class="token keyword">on</span> t2<span class="token punctuation">.</span>star<span class="token operator">=</span>t1<span class="token punctuation">.</span>_id <span class="token keyword">group</span> <span class="token keyword">by</span> t1<span class="token punctuation">.</span>name <span class="token keyword">order</span> <span class="token keyword">by</span> c <span class="token keyword">limit</span> <span class="token number">3</span> <span class="token keyword">offset</span> <span class="token number">2</span>
</code></pre><p>要查总数据条数</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> t1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span>t2<span class="token punctuation">.</span>works<span class="token punctuation">)</span> <span class="token keyword">as</span> c <span class="token keyword">from</span> star <span class="token keyword">as</span> t1 <span class="token keyword">join</span> star_works t2 <span class="token keyword">on</span> t2<span class="token punctuation">.</span>star<span class="token operator">=</span>t1<span class="token punctuation">.</span>_id <span class="token keyword">group</span> <span class="token keyword">by</span> t1<span class="token punctuation">.</span>name <span class="token keyword">order</span> <span class="token keyword">by</span> c<span class="token punctuation">)</span> <span class="token keyword">as</span> t3<span class="token punctuation">;</span>
</code></pre></div><div class="jsx-1988653958 outer"><footer class="jsx-1988653958 inner"><a href="https://github.com/01factory/01factory.github.io/edit/main/src/pages/main.md" target="_blank" rel="noreferrer noopener" class="jsx-1988653958"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" class="jsx-1988653958 s001"><g class="jsx-1988653958"><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z" class="jsx-1988653958"></path></g></svg>Edit this page on Github</a><br class="jsx-1988653958"/><a href="https://gitee.com/dfactory01/dfactory01/edit/main/src/pages/main.md" target="_blank" rel="noreferrer noopener" class="jsx-1988653958"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" class="jsx-1988653958 s001"><g class="jsx-1988653958"><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z" class="jsx-1988653958"></path></g></svg>Edit this page on Gitee</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/documents/2021/03/101533","query":{},"buildId":"mogKUjFA-WACsejxKyoEH","runtimeConfig":{},"nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-b5d19c9fca67e1a85665.js"></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.f8bd46fc02868c500bda.js" async=""></script><script src="/_next/static/chunks/d59dcf7f32a245abc64a6405ef1dce9161f1a8bf.65571f932be9853a08b3.js" async=""></script><script src="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.7f522d4c44240e733215.js" async=""></script><script src="/_next/static/chunks/main-99016dfb960f134c798a.js" async=""></script><script src="/_next/static/chunks/97441fe2b503c77439bc39e0ef50bbe5e8642838.9b340f9d21cfc83997ce.js" async=""></script><script src="/_next/static/chunks/d006a03c77e1b24ad06b238024f496d74bbfc1db.73d35c9d2664c8d142ad.js" async=""></script><script src="/_next/static/chunks/pages/_app-7467674471030778f3eb.js" async=""></script><script src="/_next/static/chunks/pages/documents/2021/03/101533-52f1ca50b78c75627388.js" async=""></script><script src="/_next/static/mogKUjFA-WACsejxKyoEH/_buildManifest.js" async=""></script><script src="/_next/static/mogKUjFA-WACsejxKyoEH/_ssgManifest.js" async=""></script></body></html>