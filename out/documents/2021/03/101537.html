<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title class="jsx-2893578415">01factory|01微工厂</title><meta name="keywords" content="01factory,dfactory,01" class="jsx-2893578415"/><meta name="description" content="微工厂,从零到壹，数字之道" class="jsx-2893578415"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" class="jsx-2893578415"/><link rel="icon" type="image/x-icon" sizes="32x32" href="/favicon-32x32.ico" class="jsx-2893578415"/><link rel="icon" type="image/x-icon" sizes="16x16" href="/favicon-16x16.ico" class="jsx-2893578415"/><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/350e09057e231801b32f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/350e09057e231801b32f.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.f8bd46fc02868c500bda.js" as="script"/><link rel="preload" href="/_next/static/chunks/d59dcf7f32a245abc64a6405ef1dce9161f1a8bf.65571f932be9853a08b3.js" as="script"/><link rel="preload" href="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.7f522d4c44240e733215.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-99016dfb960f134c798a.js" as="script"/><link rel="preload" href="/_next/static/chunks/97441fe2b503c77439bc39e0ef50bbe5e8642838.9b340f9d21cfc83997ce.js" as="script"/><link rel="preload" href="/_next/static/chunks/d006a03c77e1b24ad06b238024f496d74bbfc1db.73d35c9d2664c8d142ad.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-7467674471030778f3eb.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/documents/2021/03/101537-1396ef5514cd942a5a6b.js" as="script"/></head><body><div id="__next"><div class="jsx-86683480 row "><div class="jsx-180329529 col s002"><div class="jsx-2893578415 outer"><header class="jsx-2893578415 inner"><a class="jsx-2893578415" href="/"><img height="150" width="217" src="/images/logo.png" class="jsx-2893578415 s001"/></a></header></div></div></div><div class="jsx-86683480 row "><div class="jsx-158700623 col "><a class="jsx-2893578415" href="/home_design"><h2 class="jsx-244854117  ">方案文档</h2></a></div><div class="jsx-158700623 col "><a class="jsx-2893578415" href="/"><h2 class="jsx-244854117  ">开发文档</h2></a></div><div class="jsx-158700623 col "><a class="jsx-2893578415" href="/home_ops"><h2 class="jsx-244854117  ">运维文档</h2></a></div></div><div class="jsx-788945023"><h1>DOM</h1><h2>1. 定义</h2><p>文档对象模型，这里用到了面向对象的一些概念。简单地，我们可以把html中的每一个结点(标签)都可以看作一个dom对象，而每一个dom对象的展示形式、属性、方法可能都会不一样，但它们同属一类。</p><blockquote><p>文档对象模型（Document Object Model，简称DOM），是W3C组织推荐的处理可扩展标志语言的标准编程接口。在网页上，组织页面（或文档）的对象被组织在一个树形结构中，用来表示文档中对象的标准模型就称为DOM。Document Object Model的历史可以追溯至1990年代后期微软与Netscape的“浏览器大战”，双方为了在JavaScript与JScript一决生死，于是大规模的赋予浏览器强大的功能。微软在网页技术上加入了不少专属事物，既有VBScript、ActiveX、以及微软自家的DHTML格式等，使不少网页使用非微软平台及浏览器无法正常显示。DOM即是当时蕴酿出来的杰作。</p></blockquote><h2>2. DOM树</h2><p>在html文档中，dom对象是按树形结构组织的。根结点是一个叫作<code>document</code>的全局对象。在它下面有<code>head</code>和<code>body</code>等结点。</p><p>概念：</p><ul><li>子结点</li><li>祖先节点</li><li>父结点</li><li>兄弟结点</li></ul><p>以下为例：</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>每一个html页面都是一棵Dom树，它的<code>根节点</code>是<code>html</code>，里面通常至少有两个<code>孩子节点</code>（通常我们也称之为<code>子节点</code>）：<code>head</code>和<code>body</code>。<code>html</code>是<code>head</code>和<code>body</code>的<code>父亲节点</code>，<code>head</code>和<code>body</code>互为<code>兄弟节点</code>。而<code>head</code>和<code>body</code>又会是其它节点的<code>父亲节点</code>，如<code>head</code>为<code>title</code>的<code>节点</code>，而<code>html</code>则为<code>title</code>的<code>祖先节点</code>。</p><h2>3. 属性</h2><p>Attribute和Property的区别</p><p>特别需要提醒注意的是：html中某个节点的属性(attribute)和对应dom对象的属性(property)是不一样的，尽管有时候它们很像(像input的value和id属性),为了说明这一点，我们看下面这个简单的例子：</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;t&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">alert</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        input<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> <span class="token string">&#x27;lalala&#x27;</span><span class="token punctuation">;</span>
        <span class="token function">alert</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">alert</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token method function property-access">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#x27;value&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>t<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>abc<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><p>上例中，id为t的一个文本框中初始显示值为它的value属性(attribute)，我们在一个用户事件中，通过JavaScript脚本修改它的value属性（property)值为lalala，这时候我们在页面中看到该文本框中显示的值也已变成为了lalala,并且如果我们再获取它的value属性（property）的时候，它的值也确实改变成为了lalala。</p><p>但是，如果我们在浏览器的开发者工具中查看这个节点，我们会看到，它的value属性（attribute）依然是abc不变,通过该dom对象的getAttribute方法获取它的value属性(attribute)值也是abc。</p><h3>3.1. 属性(Attribute)</h3><p>在<a href="./base.md">前一章节</a>，我们已经介绍过Dom节点的属性，通常我们在html页面中在一个节点的开始标签的标签名称后面添加属性，不同属性之间使用空格隔开。</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tagname</span> <span class="token attr-name">attr1</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>value1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">attr2</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>value2</span> <span class="token attr-name">attr3</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#x27;</span>value3<span class="token punctuation">&#x27;</span></span> <span class="token attr-name">attr4</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tagname</span><span class="token punctuation">&gt;</span></span>
</code></pre><h4>3.1.1. 属性值为一个字符串</h4><p>上例中，<code>attr1</code>和<code>attr3</code>的属性值都是一个字符串，但有时候我们使用双引号，在另外一些时候我们使用单引号。</p><p>多数时候，我们在书写html的时候，都应该使用双引号，这是一个习惯。但有的时候，我们也会使用单引号，典型的情况是：我们在初始化的时候将一整行数据绑定到列表的一个属性上，因为属性值必须为一个字符串，所以我们需要将<a href="../base/json.md">数据转换成字符串</a>,而当我们将其转换为字符串之后，通常这个字符串中便会有双引号，这时候如果属性值外层使用双引号的话，就会出错，所以这时候我们会使用单引号避免这问题。</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> tpl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div data-value=&#x27;{{=it}}&#x27;&gt;&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token string">&#x27;test&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// render(data, tpl);</span>
</code></pre><p>事实上，<code>attr2</code>的属性值也是一个字符串，所以我们定下来这样的规范，即属性值必须加引号（双引号或单引号）。这样就不会有人会误以为一些属性值为数字或布尔值。</p><p>如<code>attr4</code>，有些属性甚至没有值，只是定义这个属性即可，典型的有类似disable，readonly，controls这样的属性。一般情况下，这一类属性用来决定<code>是</code>和<code>否</code>两种状态。</p><h4>3.1.2. 获取/设置属性值</h4><p>我们使用节点元素的<code>getAttribute</code>来获取某一个属性值，使用<code>setAttribute</code>设置属性值。</p><pre class="language-ts"><code class="language-ts"><span class="token comment">// 属性值为字符串</span>
dom<span class="token punctuation">.</span><span class="token method function property-access">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#x27;attr-name&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 属性值为数字，需要转换</span>
<span class="token function">parseInt</span><span class="token punctuation">(</span>dom<span class="token punctuation">.</span><span class="token method function property-access">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#x27;attr-name&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 属性值为boolean，需要使用字符串来判定</span>
dom<span class="token punctuation">.</span><span class="token method function property-access">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#x27;attr-name&#x27;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#x27;true&#x27;</span><span class="token punctuation">;</span>
</code></pre><h3>3.2. 属性(Property)</h3><p>一部分DOM节点元素也提供了一些属性方便我们使用， 如<code>id</code>和<code>style</code>等。我们可以直接使用这些属性进行一些操作。像<a href="./base.md">前面介绍过的</a>，此属性(Property)不同于彼属性(Attribute)。</p><h3>3.3. 样式</h3><p>样式<code>style</code>属性估计是我们使用最多的属性了，通过它，我们可以使用JavaScript脚本操作页面上的元素，使它改变颜色，形状等。如我们将某个节点元素的背景色修改为红色</p><pre class="language-ts"><code class="language-ts">node<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">backgroundColor</span> <span class="token operator">=</span> <span class="token string">&#x27;red&#x27;</span><span class="token punctuation">;</span>
</code></pre><h2>4. Dom 节点操作</h2><h3>4.1. 查找</h3><p>如果要对页面上的一个元素进行操作，首先必须查找到该元素才可以。所以，我们首先需要掌握查找dom元素的方法。</p><h4>4.1.1. 在整个页面中查找dom元素</h4><p>这种方法我们在项目中几乎不会使用，这里提一下，大家做了解即可，在项目开发过程中禁止这种用法。</p><h4>4.1.2. 通过id查找</h4><pre class="language-ts"><code class="language-ts"><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&#x27;id&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">&#x27;classNames&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementsByName</span><span class="token punctuation">(</span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&#x27;tagname&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;tagname&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">querySelector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token maybe-class-name">HTMLInputElement</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;#id&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">querySelector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token maybe-class-name">HTMLSpanElement</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;.class&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">querySelector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token maybe-class-name">HTMLTextAreaElement</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;[attribute-name]&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">querySelector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token maybe-class-name">HTMLAnchorElement</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;[attribute-name=attribute-value]&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4>4.1.3. 查找子节点</h4><ol><li><p>单个节点查找</p><pre class="language-ts"><code class="language-ts">fd<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;tagname&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fd<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">querySelector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token maybe-class-name">HTMLInputElement</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;#id&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fd<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">querySelector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token maybe-class-name">HTMLSpanElement</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;.class&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fd<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">querySelector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token maybe-class-name">HTMLTextAreaElement</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;[attribute-name]&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fd<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">querySelector</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token maybe-class-name">HTMLAnchorElement</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;[attribute-name=attribute-value]&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li><li><p>多个节点查找</p><pre class="language-ts"><code class="language-ts"><span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>fd<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&#x27;tagname&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>fd<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">querySelectorAll</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token maybe-class-name">HTMLInputElement</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;.class&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>fd<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">querySelectorAll</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token maybe-class-name">HTMLSpanElement</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;[attribute-name]&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>fd<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">node</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">querySelectorAll</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token maybe-class-name">HTMLAnchorElement</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;[attribute-name=attribute-value]&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li></ol><h4>4.1.4. 查找父(祖先)节点</h4><pre class="language-ts"><code class="language-ts">node<span class="token punctuation">.</span><span class="token property-access">parentElement</span> <span class="token keyword">as</span> <span class="token maybe-class-name">HTMLDivElement</span><span class="token punctuation">;</span>
node<span class="token punctuation">.</span><span class="token method function property-access">closest</span><span class="token punctuation">(</span><span class="token string">&#x27;tagname&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
node<span class="token punctuation">.</span><span class="token method function property-access">closest</span><span class="token punctuation">(</span><span class="token string">&#x27;.class&#x27;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token maybe-class-name">HTMLInputElement</span><span class="token punctuation">;</span>
node<span class="token punctuation">.</span><span class="token method function property-access">closest</span><span class="token punctuation">(</span><span class="token string">&#x27;[attribute-name]&#x27;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token maybe-class-name">HTMLSpanElement</span><span class="token punctuation">;</span>
node<span class="token punctuation">.</span><span class="token method function property-access">closest</span><span class="token punctuation">(</span><span class="token string">&#x27;[attribute-name=attribute-value]&#x27;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token maybe-class-name">HTMLAnchorElement</span><span class="token punctuation">;</span>
</code></pre><h3>4.2. 判定节点位置关系</h3><pre class="language-ts"><code class="language-ts">node1<span class="token punctuation">.</span><span class="token method function property-access">contains</span><span class="token punctuation">(</span>node2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// true or false</span>
</code></pre><h3>4.3. 新增</h3><h4>4.3.1. 追加子节点</h4><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">&#x27;tagname&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
node<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>或</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">&#x27;tagname&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
node<span class="token punctuation">.</span><span class="token method function property-access">insertAdjacentElement</span><span class="token punctuation">(</span><span class="token string">&#x27;beforeend&#x27;</span><span class="token punctuation">,</span> child<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>或</p><pre class="language-ts"><code class="language-ts">node<span class="token punctuation">.</span><span class="token method function property-access">insertAdjacentText</span><span class="token punctuation">(</span><span class="token string">&#x27;beforeend&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;text&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>或</p><pre class="language-ts"><code class="language-ts">node<span class="token punctuation">.</span><span class="token method function property-access">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">&#x27;beforeend&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;&lt;tagname&gt;&lt;/tagname&gt;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4>4.3.2. 在第一个子节点前插入</h4><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">&#x27;tagname&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
node<span class="token punctuation">.</span><span class="token method function property-access">insertAdjacentElement</span><span class="token punctuation">(</span><span class="token string">&#x27;afterbegin&#x27;</span><span class="token punctuation">,</span> child<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>或</p><pre class="language-ts"><code class="language-ts">node<span class="token punctuation">.</span><span class="token method function property-access">insertAdjacentText</span><span class="token punctuation">(</span><span class="token string">&#x27;afterbegin&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;text&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>或</p><pre class="language-ts"><code class="language-ts">node<span class="token punctuation">.</span><span class="token method function property-access">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">&#x27;afterbegin&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;&lt;tagname&gt;&lt;/tagname&gt;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4>4.3.3. 在某个节点前插入</h4><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> new_node <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">&#x27;tagname&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
node<span class="token punctuation">.</span><span class="token property-access">parentElement</span><span class="token punctuation">.</span><span class="token method function property-access">insertBefore</span><span class="token punctuation">(</span>new_node<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>或</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> new_node <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">&#x27;tagname&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
node<span class="token punctuation">.</span><span class="token method function property-access">insertAdjacentElement</span><span class="token punctuation">(</span><span class="token string">&#x27;beforebegin&#x27;</span><span class="token punctuation">,</span> new_node<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>或</p><pre class="language-ts"><code class="language-ts">node<span class="token punctuation">.</span><span class="token method function property-access">insertAdjacentText</span><span class="token punctuation">(</span><span class="token string">&#x27;beforebegin&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;text&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>或</p><pre class="language-ts"><code class="language-ts">node<span class="token punctuation">.</span><span class="token method function property-access">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">&#x27;beforebegin&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;&lt;tagname&gt;&lt;/tagname&gt;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4>4.3.4. 在某个节点后插入</h4><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">&#x27;tagname&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
node<span class="token punctuation">.</span><span class="token method function property-access">insertAdjacentElement</span><span class="token punctuation">(</span><span class="token string">&#x27;afterend&#x27;</span><span class="token punctuation">,</span> new_node<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>或</p><pre class="language-ts"><code class="language-ts">node<span class="token punctuation">.</span><span class="token method function property-access">insertAdjacentText</span><span class="token punctuation">(</span><span class="token string">&#x27;afterend&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;text&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>或</p><pre class="language-ts"><code class="language-ts">node<span class="token punctuation">.</span><span class="token method function property-access">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">&#x27;afterend&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;&lt;tagname&gt;&lt;/tagname&gt;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3>4.4. 修改</h3><pre class="language-ts"><code class="language-ts">node<span class="token punctuation">.</span><span class="token property-access">parentElement</span><span class="token punctuation">.</span><span class="token method function property-access">replaceChild</span><span class="token punctuation">(</span>new_node<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3>4.5. 删除</h3><pre class="language-ts"><code class="language-ts">node<span class="token punctuation">.</span><span class="token method function property-access">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>或</p><pre class="language-ts"><code class="language-ts">node<span class="token punctuation">.</span><span class="token property-access">parentElement</span><span class="token punctuation">.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3>4.6. 复制节点</h3><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> deep <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
node<span class="token punctuation">.</span><span class="token method function property-access">cloneNode</span><span class="token punctuation">(</span>deep<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2>5. 事件</h2><h3>5.1. 捕获/冒泡</h3><p>这是一个事件触发时序的问题，多数情况下这两种区别我们并不需要关心，但如果遇到特殊情况了，那就得能搞清楚原理了。</p><h4>5.1.1. 捕获</h4><p>有以下两个节点</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>如果在按钮上点击，div就会先捕获到事件，而input会后于div捕获到该事件,以下代码会先输出<code>div</code>，后输出<code>input</code>。</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> div <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;capture-div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
input<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;capture-input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4>5.1.2. 冒泡</h4><p>有以下两个节点</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>如果在按钮上点击，事件先在input上触发响应，然后才会冒泡到div上,以下代码会先输出<code>input</code>，后输出<code>div</code>，所捕获不同的是，<code>addEventListener</code>的第三个参数为<code>false</code>。</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> div <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;pop-div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
input<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;pop-input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4>5.1.3. 事件流</h4><p>有聪明的朋友马上就会问：“如果我同时绑定了捕获事件和冒泡事件呢”？</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>如果在按钮上点击，事件先在input上触发响应，然后才会冒泡到div上,以下代码会先输出<code>input</code>，后输出<code>div</code>，所捕获不同的是，<code>addEventListener</code>的第三个参数为<code>false</code>。</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> div <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;capture-div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
input<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;capture-input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;pop-div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
input<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;pop-input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>它们的响应顺序为</p><ol><li><code>capture-div</code></li><li><code>capture-input</code></li><li><code>pop-input</code></li><li><code>pop-div</code></li></ol><h4>5.1.4. 阻止捕获/冒泡</h4><p>有的时候，我们希望点击事件再传播，就需要将其阻止，如下例，我们希望事件不再向上冒泡，使用<code>e.stopPropagation();</code>之后，果然div上面的响应不再被触发。</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> div <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;pop-div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
input<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;pop-input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span><span class="token method function property-access">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>如果是捕获事件呢？在前文中我没有说阻止事件冒泡，而是说阻止事件传播，是因为方法<code>stopPropagation</code>不仅仅是用来阻止冒泡而已，看下例：</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> div <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;pop-div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span><span class="token method function property-access">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
input<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;pop-input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>同样的，事件只在div节点上被触发了一次。</p><p>那么，是不是<code>stopPropagation</code>能够解决我们所有的问题了呢？答案是否定的，看下例</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> div <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;capture-div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
input<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;capture-input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span><span class="token method function property-access">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
input<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;pop-input&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
input<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;lalala&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;pop-div&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>糟糕，在<code>capture-input</code>之后，<code>pop-input</code>，甚至<code>lalala</code>都出来了，这也许不是我们想要的结果，怎么做呢，答案是将<code>stopPropagation</code>换成<code>stopImmediatePropagation</code>就可以了。那么方法<code>stopPropagation</code>和<code>stopImmediatePropagation</code>的差别是什么呢？从名字上看，就差了一个<code>Immediate</code>，英国普通话讲，这个意思是<code>立即，马上</code>的意思，加上<code>Immediate</code>就马上停止了。实际上，<code>stopImmediatePropagation</code>确实是让事件<code>马上</code>停止了传播，而<code>stopPropagation</code>则是到<strong>当前响应事件的dom节点为止</strong>，这其中的差异，不可不察。</p><h3>5.2. 委托</h3><p>什么又是事件委托呢，事件委托是指利用事件模型，在外层的某个节点上绑定事件，而它内部的其它节点则委托<code>这个节点</code>进行事件的响应处理。</p><p>例如</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">data-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">data-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">data-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">data-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>4<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">data-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">data-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>6<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">data-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>7<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">data-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">data-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>9<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">data-value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>利用事件模型，我们只需要给外层的ul节点绑定一次事件即可，无须给每个li绑定事件</p><pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> ul <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;ul&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ul<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">dataset</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>它的最佳使用场景是什么呢？就是现今移动端的列表页面。因为列表中的某一行的事件，如果交由每一行去做，监听的事件太多了，会拖慢整个页面的响应速度，某些低端的android机性能可能会是很差的。但这还不是最要命的，要命的是，列表里的内容是不固定的，通常我们是会在列表快要到底部时再加载更多内容，甚至在某些对性能要求非常严格的场景下，我们需要移除最上面已经加载过了一些内容，防止一直加载更多导致列表过大性能下降。这个时候如果不使用委托，可以想像整个页面的性能和开发的复杂程度。使用委托，只需要给列表外层的某个节点绑定一次事件就搞定了，无论是从性能还是从开发的复杂程度上讲，都是最优的。</p><h2>6. 方法</h2><p>前面我们已经提到过了一些dom节点元素的方法，以及设置和获取属性（Attribute）的方法。除了那些之外，一些特定的节点还有一些独特的方法，比如<code>Form</code>有<code>submit</code>方法，比如<code>Video</code>有<code>play</code>,<code>stop</code>方法等。通过这些方法，才将一个静态的页面变成为了可以接受用户事件的页面。</p></div><div class="jsx-1988653958 outer"><footer class="jsx-1988653958 inner"><a href="https://github.com/01factory/01factory.github.io/edit/main/src/pages/main.md" target="_blank" rel="noreferrer noopener" class="jsx-1988653958"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" class="jsx-1988653958 s001"><g class="jsx-1988653958"><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z" class="jsx-1988653958"></path></g></svg>Edit this page on Github</a><br class="jsx-1988653958"/><a href="https://gitee.com/dfactory01/dfactory01/edit/main/src/pages/main.md" target="_blank" rel="noreferrer noopener" class="jsx-1988653958"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" class="jsx-1988653958 s001"><g class="jsx-1988653958"><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z" class="jsx-1988653958"></path></g></svg>Edit this page on Gitee</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/documents/2021/03/101537","query":{},"buildId":"_fFKntTW3S-P79kvAAV6k","runtimeConfig":{},"nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-b5d19c9fca67e1a85665.js"></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.f8bd46fc02868c500bda.js" async=""></script><script src="/_next/static/chunks/d59dcf7f32a245abc64a6405ef1dce9161f1a8bf.65571f932be9853a08b3.js" async=""></script><script src="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.7f522d4c44240e733215.js" async=""></script><script src="/_next/static/chunks/main-99016dfb960f134c798a.js" async=""></script><script src="/_next/static/chunks/97441fe2b503c77439bc39e0ef50bbe5e8642838.9b340f9d21cfc83997ce.js" async=""></script><script src="/_next/static/chunks/d006a03c77e1b24ad06b238024f496d74bbfc1db.73d35c9d2664c8d142ad.js" async=""></script><script src="/_next/static/chunks/pages/_app-7467674471030778f3eb.js" async=""></script><script src="/_next/static/chunks/pages/documents/2021/03/101537-1396ef5514cd942a5a6b.js" async=""></script><script src="/_next/static/_fFKntTW3S-P79kvAAV6k/_buildManifest.js" async=""></script><script src="/_next/static/_fFKntTW3S-P79kvAAV6k/_ssgManifest.js" async=""></script></body></html>