_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[132],{Cjvt:function(t,n,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/documents/2021/04/30/2107",function(){return e("OsXg")}])},OsXg:function(t,n,e){"use strict";e.r(n),e.d(n,"default",(function(){return u}));var r=e("rePB"),o=e("Ff2n"),s=(e("q1tI"),e("7ljp")),a=e("3wrV");function p(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function i(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?p(Object(e),!0).forEach((function(n){Object(r.a)(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):p(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}var c={};function u(t){var n=t.components,e=Object(o.a)(t,["components"]);return Object(s.a)("wrapper",i(i(i({},c),e),{},{components:n,mdxType:"MDXLayout"}),Object(s.a)("h1",null,"\u7528\u6237\u6ce8\u518c"),Object(s.a)(a.a,{lan:"ts",code:"\nimport { createHash } from 'crypto';\nimport nextConnect from 'next-connect';\nimport { NextApiRequest, NextApiResponse, PageConfig } from 'next';\nimport anylogger from 'anylogger';\nimport '@mmstudio/an000042';\nimport an49 from '@mmstudio/an000049';\n\nconst logger = anylogger('pages/api/regdit');\n\nexport type Result = boolean;\n\nexport type regtype = '1' | '2' | '3';\n\nexport type Message = {\n\tuser: string;\n\tname: string;\n\tpsw: string;\n\tphone: string;\n\tarea: string;\n\temail: string;\n\ttype: regtype;\n}\n\n/**\n * \u7528\u6237\u6ce8\u518c\n */\nconst handler = nextConnect<NextApiRequest, NextApiResponse<Result>>();\n\nhandler.put(async (req, res) => {\n\tlogger.debug('msg body:', req.body);\n\tconst { area, phone, psw, user, name, email, type } = req.body as Message;\n\tconst db = an49();\n\tconst tb1 = db<ITbuser>('user');\n\tconst e = await tb1.first('userid').where({\n\t\tuserid: user\n\t});\n\tif (e) {\n\t\tconst msg = encodeURIComponent('\u7528\u6237\u5df2\u5b58\u5728');\n\t\tres.statusMessage = msg;\n\t\tres.status(500).json(false);\n\t} else {\n\t\tconst tb2 = db<ITbuser>('user');\n\t\tconst val = md5(psw);\n\t\tawait tb2.insert({\n\t\t\tuserid: user,\n\t\t\tname,\n\t\t\tphone,\n\t\t\tpsw: val,\n\t\t\temail,\n\t\t\trole: 'team'\n\t\t});\n\t\tconst tb4 = db<ITbtype>('type');\n\t\tconst data = await tb4.first('type').where({\n\t\t\ttype_no: type\n\t\t});\n\t\tconst tb3 = db<ITbteam>('team');\n\t\tawait tb3.insert({\n\t\t\tuserid: user,\n\t\t\tarea,\n\t\t\tproject_type_no: type,\n\t\t\tproject_type: data.type,\n\t\t\tphone\n\t\t});\n\t\tres.status(200).json(true);\n\t}\n});\n\nexport const config = {} as PageConfig;\n\nexport default handler;\n\nfunction md5(value: string) {\n\treturn createHash('md5').update(value).digest('hex');\n}\n",mdxType:"CodeEditor"}))}u.isMDXComponent=!0}},[["Cjvt",0,1,2,3,4,5]]]);