_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[58],{SogW:function(t,n,e){"use strict";e.r(n),e.d(n,"default",(function(){return v}));var r=e("rePB"),a=e("Ff2n"),o=e("q1tI"),c=e("7ljp"),s=e("3wrV"),i=e("XLUx"),u=e("o0o1"),l=e.n(u),f=e("HaE+");function p(t,n,e){return h.apply(this,arguments)}function h(){return(h=Object(f.a)(l.a.mark((function t(n,e,r){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){setTimeout((function(){t({foo:"bar"})}),3e3)})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var d=e("tzy5"),m=e("TxzI");function y(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function b(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?y(Object(e),!0).forEach((function(n){Object(r.a)(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):y(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}var g={};function v(t){var n=t.components,e=Object(a.a)(t,["components"]);return Object(c.a)("wrapper",b(b(b({},g),e),{},{components:n,mdxType:"MDXLayout"}),Object(c.a)("h1",null,"\u641c\u7d22\u6846\u7ec4\u4ef6"),Object(c.a)("h2",null,"\u7279\u6027"),Object(c.a)("ol",null,Object(c.a)("li",{parentName:"ol"},"\u652f\u6301\u641c\u7d22\u4e2d\u72b6\u6001"),Object(c.a)("li",{parentName:"ol"},"\u6d4f\u89c8\u5668\u5c40\u90e8\u6e32\u67d3,\u7528\u6237\u4f53\u9a8c\u597d"),Object(c.a)("li",{parentName:"ol"},"\u4fee\u6539\u5730\u5740\u680f,\u5373\u4f7f\u5237\u65b0\u9875\u9762,\u641c\u7d22\u6761\u4ef6\u4e0d\u4e22\u5931"),Object(c.a)("li",{parentName:"ol"},"\u5982\u679c\u5f53\u524d\u9875\u7801\u4e0d\u662f\u9996\u9875,\u641c\u7d22\u540e\u8df3\u8f6c\u5230\u9996\u9875,\u5c40\u90e8\u6e32\u67d3,\u9875\u9762\u65e0\u5237\u767d"),Object(c.a)("li",{parentName:"ol"},"\u6b63\u5728\u641c\u7d22\u65f6\u6309\u94ae\u7f6e\u7070\u4e0d\u5141\u8bb8\u518d\u6b21\u641c\u7d22.")),Object(c.a)("h2",null,"\u4f9d\u8d56"),Object(c.a)("p",null,"\u4f9d\u8d56\u7b2c\u4e09\u65b9\u7ec4\u4ef6",Object(c.a)("inlineCode",{parentName:"p"},"use-url-search-params"),",\u9700\u8981\u5b89\u88c5\u8be5\u7ec4\u4ef6\u4f9d\u8d56"),Object(c.a)(s.a,{lan:"shell",code:"\nyarn add use-url-search-params\n",mdxType:"CodeEditor"}),Object(c.a)("h2",null,"\u793a\u4f8b"),Object(c.a)(i.a,{scope:{smartfetch:p,useUrlSearchParams:d.useUrlSearchParams,useState:o.useState,Loading:m.Loading},code:"\n()=>{\nfunction Search({ initq, service, onChange }) {\n\tconst [q, setq] = useState(initq);\n\tconst [, setParams] = useUrlSearchParams({ q }, { q: String });\n\tconst [searching, setsearching] = useState(false);\n\tasync function search() {\n\t\tif (searching) {\n\t\t\treturn;\n\t\t}\n\t\tsetsearching(true);\n\t\ttry {\n\t\t\tsetParams({ q });\n\t\t\tconst data = await smartfetch(service, 'post', { q });\n\t\t\tonChange({\n\t\t\t\t...data,\n\t\t\t\tpage: 1,\n\t\t\t\tq\n\t\t\t});\n\t\t} finally {\n\t\t\tsetsearching(false);\n\t\t}\n\t}\n\treturn <>\n\t\t<div className='cls001'>\n\t\t\t{searching ? <div className='cls004'><Loading>Searching...</Loading></div> : <input className='cls002' type='search' autoFocus value={q} placeholder='\u641c\u7d22' onChange={(e) => {\n\t\t\t\tsetq(e.target.value);\n\t\t\t}} onKeyPress={(e) => {\n\t\t\t\tif (e.nativeEvent.key === 'Enter') {\n\t\t\t\t\tsearch();\n\t\t\t\t}\n\t\t\t}} />}\n\t\t\t<input disabled={searching} className='cls003' type='button' value='\u641c\u7d22' onClick={search} />\n\t\t</div>\n\t\t<style jsx>{`\n.cls001{\ndisplay: flex;\njustify-content: flex-end;\nmargin: 2rem;\n}\n.cls002,.cls003, .cls004{\nborder-radius: 0.4rem;\nline-height: 1.3rem;\n}\n.cls003{\ncolor:#fff;\nbackground-color: #007fcb;\ntransition: all 600ms;\npadding: 0.5rem 1rem;\n}\n.cls003:hover{\nbackground-color: #0081cbc9;\n}\n.cls002,.cls004{\nwidth: 15rem;\n}\n.cls004{\nborder: solid 1px grey;\n}\n`}</style>\n\t</>;\n}\n\n\nreturn <Search initq='01factory' service='#' onChange={(e)=>{\nconsole.log('value', e);\n}} />\n}\n",mdxType:"PlayGround"}),Object(c.a)("h2",null,"\u5b8c\u6574\u4ee3\u7801"),Object(c.a)(s.a,{lan:"ts",code:"\nexport default async function smartfetch<R, M = unknown>(service: string, method: 'get' | 'put' | 'post' | 'delete', msg?: M) {\n\tconst body = JSON.stringify(msg);\n\tconst res = await fetch(service, {\n\t\tmethod,\n\t\tbody,\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json; charset=utf-8'\n\t\t}\n\t});\n\tif (res.ok) {\n\t\tconst data = await res.json() as R;\n\t\treturn data;\n\t}\n\tthrow new Error(decodeURIComponent(res.statusText));\n}\n",mdxType:"CodeEditor"}),Object(c.a)(s.a,{lan:"ts",code:"\nimport smartfetch from '../atoms/smartfetch';\nimport { useUrlSearchParams } from \"use-url-search-params\";\nimport { useState } from 'react';\nimport { Loading } from '@geist-ui/react';\n\ninterface IProps<T> {\n\tpage: number;\n\tcount: number;\n\tdata: T[];\n\tq: string;\n}\n\n/**\n * Search\n */\nexport default function Search<T>({ initq, service, onChange }: {\n\tinitq: string;\n\tservice: string;\n\tonChange(v: IProps<T>): void;\n}) {\n\tconst [q, setq] = useState(initq);\n\tconst [, setParams] = useUrlSearchParams({ q }, { q: String });\n\tconst [searching, setsearching] = useState(false);\n\tasync function search() {\n\t\tif (searching) {\n\t\t\treturn;\n\t\t}\n\t\tsetsearching(true);\n\t\ttry {\n\t\t\tsetParams({ q });\n\t\t\tconst pathname = window.location.pathname;\n\t\t\tconst paths = pathname.split('/');\n\t\t\tconst pg = paths.pop();\n\t\t\tif (pg !== '1') {\n\t\t\t\tpaths.push('1');\n\t\t\t\twindow.history.replaceState({}, null, paths.join('/'));\n\t\t\t}\n\t\t\tconst data = await smartfetch<{\n\t\t\t\tcount: number;\n\t\t\t\tdata: T[];\n\t\t\t}, { q: string; }>(service, 'post', { q });\n\t\t\tonChange({\n\t\t\t\t...data,\n\t\t\t\tpage: 1,\n\t\t\t\tq\n\t\t\t});\n\t\t} finally {\n\t\t\tsetsearching(false);\n\t\t}\n\t}\n\treturn <>\n\t\t<div className='cls001'>\n\t\t\t{searching ? <div className='cls004'><Loading>Searching...</Loading></div> : <input className='cls002' type='search' autoFocus value={q} placeholder='\u641c\u7d22' onChange={(e) => {\n\t\t\t\tsetq(e.target.value);\n\t\t\t}} onKeyPress={(e) => {\n\t\t\t\tif (e.nativeEvent.key === 'Enter') {\n\t\t\t\t\tsearch();\n\t\t\t\t}\n\t\t\t}} />}\n\t\t\t<input disabled={searching} className='cls003' type='button' value='\u641c\u7d22' onClick={search} />\n\t\t</div>\n\t\t<style jsx>{`\n.cls001{\ndisplay: flex;\njustify-content: flex-end;\nmargin: 2rem;\n}\n.cls002,.cls003, .cls004{\nborder-radius: 0.4rem;\nline-height: 1.3rem;\n}\n.cls003{\ncolor:#fff;\nbackground-color: #007fcb;\ntransition: all 600ms;\npadding: 0.5rem 1rem;\n}\n.cls003:hover{\nbackground-color: #0081cbc9;\n}\n.cls002,.cls004{\nwidth: 15rem;\n}\n.cls004{\nborder: solid 1px grey;\n}\n`}</style>\n\t</>;\n}\n",mdxType:"CodeEditor"}))}v.isMDXComponent=!0},asIO:function(t,n,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/codes/2021/05/18/1524",function(){return e("SogW")}])},tzy5:function(t,n,e){!function(t,n){"use strict";function e(t){return(e="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function a(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function o(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?a(Object(e),!0).forEach((function(n){r(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):a(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function c(t,n){return s(t)||i(t,n)||u(t,n)||f()}function s(t){if(Array.isArray(t))return t}function i(t,n){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var e=[],r=!0,a=!1,o=void 0;try{for(var c,s=t[Symbol.iterator]();!(r=(c=s.next()).done)&&(e.push(c.value),!n||e.length!==n);r=!0);}catch(i){a=!0,o=i}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return e}}function u(t,n){if(t){if("string"===typeof t)return l(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?l(t,n):void 0}}function l(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function f(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(t,n){var e;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(e=u(t))||n&&t&&"number"===typeof t.length){e&&(t=e);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,s=!1;return{s:function(){e=t[Symbol.iterator]()},n:function(){var t=e.next();return c=t.done,t},e:function(t){s=!0,o=t},f:function(){try{c||null==e.return||e.return()}finally{if(s)throw o}}}}n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;var h=function(){},d={popstate:[]},m={URL:function(){this.searchParams={set:h,append:h,delete:h}},location:{href:"",search:""},history:{pushState:h},fireEvent:function(t){d[t].forEach((function(t){t()}))},addEventListener:function(t,n){d[t].push(n)},removeEventListener:function(t,n){var e=d[t],r=e.findIndex((function(t){return t===n}));e.splice(r,1)}};function y(){return"undefined"!==typeof window?window:m}var b=[Number,String,Boolean,Date];function g(t){var n=new(0,y().URL)(y().location.href);return Object.keys(t).forEach((function(r){var a=t[r];null!==a&&void 0!==a?Array.isArray(a)?(n.searchParams.delete(r),a.forEach((function(t){n.searchParams.append(r,t)}))):a instanceof Date?isNaN(a.getTime())||n.searchParams.set(r,a.toISOString()):"object"===e(a)?n.searchParams.set(r,JSON.stringify(a)):n.searchParams.set(r,a):n.searchParams.delete(r)})),n}function v(t){return Array.isArray(t)&&t.length>0&&t.every((function(t){return"number"===typeof t||"string"===typeof t||"boolean"===typeof t}))}function O(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Object.values(t).every((function(t){return b.includes(t)||v(t)||"function"===typeof t})))throw new Error("Unsupported param types. Must be one of [".concat(b.map((function(t){return t.name})).join(", "),"]"))}function j(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;e&&O(e);var r=c(n.useState(),2)[1],a=y().location.search,s=n.useMemo((function(){return new URLSearchParams(a)}),[a]),i=n.useMemo((function(){var n,r=[],a=p(s);try{for(a.s();!(n=a.n()).done;){var i=n.value;r.push({key:i[0],value:i[1]})}}catch(l){a.e(l)}finally{a.f()}r=r.reduce((function(t,n){return(t[n.key]=t[n.key]||[]).push(n),t}),{}),r=Object.keys(r).map((function(t){var n=r[t];return 1===n.length?[t,n[0].value]:[t,n.map((function(t){return t.value}))]}));var u=o({},t);return r.forEach((function(n){var r=c(n,2),a=r[0],o=r[1];u[a]=S(a,o,e,t)})),u}),[s]);function u(t){var n=g(t);y().location.search!==n.search&&y().history.pushState({},"",n),s.toString()!==n.searchParams.toString()&&r({})}n.useEffect((function(){u(o(o({},t),i))}),[i]);var l=function(t){u(t)};return n.useEffect((function(){var t=function(){r({})};return y().addEventListener("popstate",t),function(){y().removeEventListener("popstate",t)}}),[]),[i,l]}var w={true:!0,false:!1};function S(t,n,e,r){if(!e)return n;var a=e[t],o=void 0===n?r[t]:n;return a===Number?Number(o):a===Boolean?w[o]:a===Date?new Date(o):Array.isArray(a)?a.find((function(t){return t==o}))||r[t]:"function"===typeof a?a(o):o}t.useUrlSearchParams=j,Object.defineProperty(t,"__esModule",{value:!0})}(n,e("q1tI"))}},[["asIO",0,1,8,2,4,3,5,6,7]]]);