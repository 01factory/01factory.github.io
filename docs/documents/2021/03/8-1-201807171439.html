<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title class="jsx-2893578415">01factory|01微工厂</title><meta name="keywords" content="01factory,dfactory,01" class="jsx-2893578415"/><meta name="description" content="微工厂,从零到壹，数字之道" class="jsx-2893578415"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" class="jsx-2893578415"/><link rel="icon" type="image/x-icon" sizes="32x32" href="/favicon-32x32.ico" class="jsx-2893578415"/><link rel="icon" type="image/x-icon" sizes="16x16" href="/favicon-16x16.ico" class="jsx-2893578415"/><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/350e09057e231801b32f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/350e09057e231801b32f.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.f8bd46fc02868c500bda.js" as="script"/><link rel="preload" href="/_next/static/chunks/efe5b9f0e475b9630f05da880d915321f7ac39a1.65571f932be9853a08b3.js" as="script"/><link rel="preload" href="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.7f522d4c44240e733215.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-99016dfb960f134c798a.js" as="script"/><link rel="preload" href="/_next/static/chunks/edb17fefdb916118799d68ee0d51c15dd1b15581.9b340f9d21cfc83997ce.js" as="script"/><link rel="preload" href="/_next/static/chunks/7d6be8e52b15a1c2ee8b372d368ff9b522366852.73d35c9d2664c8d142ad.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-7467674471030778f3eb.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/documents/2021/03/8-1-201807171439-7e155643a8e7e3135b77.js" as="script"/></head><body><div id="__next"><div class="jsx-86683480 row "><div class="jsx-180329529 col s002"><div class="jsx-2893578415 outer"><header class="jsx-2893578415 inner"><a class="jsx-2893578415" href="/"><img height="150" width="217" src="/images/logo.png" class="jsx-2893578415 s001"/></a></header></div></div></div><div class="jsx-86683480 row "><div class="jsx-158700623 col "><a class="jsx-2893578415" href="/home_design"><h2 class="jsx-244854117  ">方案文档</h2></a></div><div class="jsx-158700623 col "><a class="jsx-2893578415" href="/"><h2 class="jsx-244854117  ">开发文档</h2></a></div><div class="jsx-158700623 col "><a class="jsx-2893578415" href="/home_ops"><h2 class="jsx-244854117  ">运维文档</h2></a></div></div><div class="jsx-788945023"><p>搭建简易git服务器</p><p>项目名称</p><p>文件名称</p><p>搭建简易git服务器</p><p>编制部门</p><p>后台运维</p><p>作者</p><p>丁正凯</p><p>当前版本</p><p>201807171439</p><p>受众范围</p><p>后台运维</p><p>文档控制</p><p><strong>修改记录</strong></p><p>日期</p><p>版本</p><p>修改类型</p><p>修改主要内容</p><p>作者</p><p>◆修改类型：A增加、B删除、C修改</p><p><strong>审阅人</strong></p><p>姓名</p><p>部门</p><p>职位</p><p>审阅签字</p><p>审阅时间</p><p><strong>存档</strong></p><p>存档时间</p><p>存放方式</p><p>存放地点、位置</p><p>备注</p><p>◆存放方式：A电子、B纸质</p><p>目录</p><p>1 搭建Git服务器	1</p><p>2 管理公钥	2</p><p>3 管理权限	2</p><p>4 小结	3</p><ol><li><a href=""></a><a href=""></a><a href=""></a>搭建Git服务器</li></ol><p>参考：</p><p>https://blog<!-- -->.<!-- -->sbot<!-- -->.<!-- -->io/articles/13</p><p>https://blog<!-- -->.<!-- -->sbot<!-- -->.<!-- -->io/articles/14</p><p>https://www<!-- -->.<!-- -->liaoxuefeng<!-- -->.<!-- -->com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/00137583770360579bc4b458f044ce7afed3df579123eca000</p><p>搭建Git远程仓库纯粹为了7x24小时开机并交换大家的修改。</p><p>GitHub就是一个免费托管开源代码的远程仓库。但是对于某些视源代码如生命的商业公司来说，既不想公开源代码，又舍不得给GitHub交保护费，那就只能自己搭建一台Git服务器作为私有仓库使用。</p><p>搭建Git服务器需要准备一台运行Linux的机器，推荐用Debian或CentOS，这样，通过几条简单的apt命令就可以完成安装。</p><p>假设你已经有sudo权限的用户账号，下面，正式开始安装。</p><p>第一步，安装git：</p><p>sudo apt<!-- -->-<!-- -->get install git</p><p>第二步，创建一个git用户，用来运行git服务：</p><p>sudo adduser git</p><p>第三步，创建证书登录：</p><p>收集所有需要登录的用户的公钥，就是他们自己的id<!-- -->_<!-- -->rsa<!-- -->.<!-- -->pub文件，把所有公钥导入到/home/git/<!-- -->.<!-- -->ssh/authorized<!-- -->_<!-- -->keys文件里，一行一个。</p><p>第四步，初始化Git仓库：</p><p>先选定一个目录作为Git仓库，假定是/srv/sample<!-- -->.<!-- -->git，在/srv目录下输入命令：</p><p>sudo git init <!-- -->-<!-- -->-<!-- -->bare sample<!-- -->.<!-- -->git</p><p>Git就会创建一个裸仓库，裸仓库没有工作区，因为服务器上的Git仓库纯粹是为了共享，所以不让用户直接登录到服务器上去改工作区，并且服务器上的Git仓库通常都以<!-- -->.<!-- -->git结尾。然后，把owner改为git：</p><p>$ sudo chown <!-- -->-<!-- -->R git:git sample<!-- -->.<!-- -->git</p><p>第五步，禁用shell登录：</p><p>出于安全考虑，第二步创建的git用户不允许登录shell，这可以通过编辑/etc/passwd文件完成。找到类似下面的一行：</p><p>git:x:1001:1001:,,,:/home/git:/bin/bash</p><p>改为：</p><p>git:x:1001:1001:,,,:/home/git:/usr/bin/git<!-- -->-<!-- -->shell</p><p>这样，git用户可以正常通过ssh使用git，但无法登录shell，因为我们为git用户指定的git<!-- -->-<!-- -->shell每次一登录就自动退出。</p><p>第六步，克隆远程仓库：</p><p>现在，可以通过git clone命令克隆远程仓库了，在各自的电脑上运行：</p><p>git clone git@server:/srv/sample<!-- -->.<!-- -->git</p><p>Cloning into &#x27;sample&#x27;<!-- -->.<!-- -->.<!-- -->.<!-- -->warning: You appear to have cloned an empty repository<!-- -->.</p><p>剩下的推送就简单了。</p><ol><li><a href=""></a><a href=""></a>管理公钥</li></ol><p>如果团队很小，把每个人的公钥收集起来放到服务器的/home/git/<!-- -->.<!-- -->ssh/authorized<!-- -->_<!-- -->keys文件里就是可行的。如果团队有几百号人，就没法这么玩了，这时，可以用<!-- -->[Gitosis]<!-- -->(<a href="https://github.com/res0nat0r/gitosis%22">https://github.com/res0nat0r/gitosis&quot;</a> \t &quot;/home/dingzhengkai/Documents<!-- -->\<!-- -->x/_blank)来管理公钥。</p><ol><li><a href=""></a><a href=""></a>管理权限</li></ol><p>有很多不但视源代码如生命，而且视员工为窃贼的公司，会在版本控制系统里设置一套完善的权限控制，每个人是否有读写权限会精确到每个分支甚至每个目录下。因为Git是为Linux源代码托管而开发的，所以Git也继承了开源社区的精神，不支持权限控制。不过，因为Git支持钩子（hook），所以，可以在服务器端编写一系列脚本来控制提交等操作，达到权限控制的目的。<!-- -->[Gitolite]<!-- -->(<a href="https://github.com/sitaramc/gitolite%22">https://github.com/sitaramc/gitolite&quot;</a> \t &quot;/home/dingzhengkai/Documents<!-- -->\<!-- -->x/_blank)就是这个工具。</p><ol><li><a href=""></a><a href=""></a>小结</li></ol><p>搭建Git服务器非常简单，通常10分钟即可完成；</p><p>要方便管理公钥，用<!-- -->[Gitosis]<!-- -->(<a href="https://github.com/sitaramc/gitolite%22">https://github.com/sitaramc/gitolite&quot;</a> \t &quot;/home/dingzhengkai/Documents<!-- -->\<!-- -->x/_blank)；</p><p>要像SVN那样变态地控制权限，用<!-- -->[Gitolite]<!-- -->(<a href="https://github.com/sitaramc/gitolite%22">https://github.com/sitaramc/gitolite&quot;</a> \t &quot;/home/dingzhengkai/Documents<!-- -->\<!-- -->x/_blank)。</p></div><div class="jsx-1988653958 outer"><footer class="jsx-1988653958 inner"><a href="https://github.com/01factory/01factory.github.io/edit/main/src/pages/main.md" target="_blank" rel="noreferrer noopener" class="jsx-1988653958"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" class="jsx-1988653958 s001"><g class="jsx-1988653958"><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z" class="jsx-1988653958"></path></g></svg>Edit this page on Github</a><br class="jsx-1988653958"/><a href="https://gitee.com/dfactory01/dfactory01/edit/main/src/pages/main.md" target="_blank" rel="noreferrer noopener" class="jsx-1988653958"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" class="jsx-1988653958 s001"><g class="jsx-1988653958"><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z" class="jsx-1988653958"></path></g></svg>Edit this page on Gitee</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/documents/2021/03/8-1-201807171439","query":{},"buildId":"Xzo6kYcsOi3BexPEf7a5Z","runtimeConfig":{},"nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-5caa60317e4d0196bd5f.js"></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.f8bd46fc02868c500bda.js" async=""></script><script src="/_next/static/chunks/efe5b9f0e475b9630f05da880d915321f7ac39a1.65571f932be9853a08b3.js" async=""></script><script src="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.7f522d4c44240e733215.js" async=""></script><script src="/_next/static/chunks/main-99016dfb960f134c798a.js" async=""></script><script src="/_next/static/chunks/edb17fefdb916118799d68ee0d51c15dd1b15581.9b340f9d21cfc83997ce.js" async=""></script><script src="/_next/static/chunks/7d6be8e52b15a1c2ee8b372d368ff9b522366852.73d35c9d2664c8d142ad.js" async=""></script><script src="/_next/static/chunks/pages/_app-7467674471030778f3eb.js" async=""></script><script src="/_next/static/chunks/pages/documents/2021/03/8-1-201807171439-7e155643a8e7e3135b77.js" async=""></script><script src="/_next/static/Xzo6kYcsOi3BexPEf7a5Z/_buildManifest.js" async=""></script><script src="/_next/static/Xzo6kYcsOi3BexPEf7a5Z/_ssgManifest.js" async=""></script></body></html>