_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[58],{SogW:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return v}));var r=n("rePB"),a=n("Ff2n"),o=n("q1tI"),c=n("7ljp"),i=n("3wrV"),s=n("XLUx"),u=n("o0o1"),l=n.n(u),f=n("HaE+");function p(t,e,n){return h.apply(this,arguments)}function h(){return(h=Object(f.a)(l.a.mark((function t(e,n,r){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){setTimeout((function(){t({foo:"bar"})}),3e3)})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var m=n("tzy5"),y=n("TxzI");function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function b(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){Object(r.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var g={};function v(t){var e=t.components,n=Object(a.a)(t,["components"]);return Object(c.a)("wrapper",b(b(b({},g),n),{},{components:e,mdxType:"MDXLayout"}),Object(c.a)("h1",null,"\u641c\u7d22\u6846\u7ec4\u4ef6"),Object(c.a)("h2",null,"\u7279\u6027"),Object(c.a)("ol",null,Object(c.a)("li",{parentName:"ol"},"\u652f\u6301\u641c\u7d22\u4e2d\u72b6\u6001"),Object(c.a)("li",{parentName:"ol"},"\u6d4f\u89c8\u5668\u5c40\u90e8\u6e32\u67d3,\u7528\u6237\u4f53\u9a8c\u597d"),Object(c.a)("li",{parentName:"ol"},"\u4fee\u6539\u5730\u5740\u680f,\u5373\u4f7f\u5237\u65b0\u9875\u9762,\u641c\u7d22\u6761\u4ef6\u4e0d\u4e22\u5931"),Object(c.a)("li",{parentName:"ol"},"\u5982\u679c\u5f53\u524d\u9875\u7801\u4e0d\u662f\u9996\u9875,\u641c\u7d22\u540e\u8df3\u8f6c\u5230\u9996\u9875,\u5c40\u90e8\u6e32\u67d3,\u9875\u9762\u65e0\u5237\u767d"),Object(c.a)("li",{parentName:"ol"},"\u6b63\u5728\u641c\u7d22\u65f6\u6309\u94ae\u7f6e\u7070\u4e0d\u5141\u8bb8\u518d\u6b21\u641c\u7d22.")),Object(c.a)("h2",null,"\u4f9d\u8d56"),Object(c.a)("p",null,"\u4f9d\u8d56\u7b2c\u4e09\u65b9\u7ec4\u4ef6",Object(c.a)("inlineCode",{parentName:"p"},"use-url-search-params"),",\u9700\u8981\u5b89\u88c5\u8be5\u7ec4\u4ef6\u4f9d\u8d56"),Object(c.a)(i.a,{lan:"shell",code:"\nyarn add use-url-search-params\n",mdxType:"CodeEditor"}),Object(c.a)("h2",null,"\u793a\u4f8b"),Object(c.a)(s.a,{scope:{smartfetch:p,useUrlSearchParams:m.useUrlSearchParams,useState:o.useState,Loading:y.Loading},code:"\n()=>{\nfunction Search({ initq, service, onChange }) {\n\tconst [q, setq] = useState(initq);\n\tconst [, setParams] = useUrlSearchParams({ q }, { q: String });\n\tconst [searching, setsearching] = useState(false);\n\tasync function search() {\n\t\tif (searching) {\n\t\t\treturn;\n\t\t}\n\t\tsetsearching(true);\n\t\ttry {\n\t\t\tsetParams({ q });\n\t\t\tconst data = await smartfetch(service, 'post', { q });\n\t\t\tonChange({\n\t\t\t\t...data,\n\t\t\t\tpage: 1,\n\t\t\t\tq\n\t\t\t});\n\t\t} finally {\n\t\t\tsetsearching(false);\n\t\t}\n\t}\n\treturn <>\n\t\t<div className='cls001'>\n\t\t\t{searching ? <div className='cls004'><Loading>Searching...</Loading></div> : <input className='cls002' type='search' autoFocus value={q} placeholder='\u641c\u7d22' onChange={(e) => {\n\t\t\t\tsetq(e.target.value);\n\t\t\t}} onKeyPress={(e) => {\n\t\t\t\tif (e.nativeEvent.key === 'Enter') {\n\t\t\t\t\tsearch();\n\t\t\t\t}\n\t\t\t}} />}\n\t\t\t<input disabled={searching} className='cls003' type='button' value='\u641c\u7d22' onClick={search} />\n\t\t</div>\n\t\t<style jsx>{`\n.cls001{\ndisplay: flex;\njustify-content: flex-end;\nmargin: 2rem;\n}\n.cls002,.cls003, .cls004{\nborder-radius: 0.4rem;\nline-height: 1.3rem;\n}\n.cls003{\ncolor:#fff;\nbackground-color: #007fcb;\ntransition: all 600ms;\npadding: 0.5rem 1rem;\n}\n.cls003:hover{\nbackground-color: #0081cbc9;\n}\n.cls002,.cls004{\nwidth: 15rem;\n}\n.cls004{\nborder: solid 1px grey;\n}\n`}</style>\n\t</>;\n}\n\n\nreturn <Search initq='01factory' service='#' onChange={(e)=>{\nconsole.log('value', e);\n}} />\n}\n",mdxType:"PlayGround"}),Object(c.a)("h2",null,"\u5b8c\u6574\u4ee3\u7801"),Object(c.a)(i.a,{lan:"ts",code:"\nimport router from 'next/router';\nimport { useUrlSearchParams } from \"use-url-search-params\";\nimport { useState } from 'react';\nimport { Loading } from '@geist-ui/react';\nimport smartfetch from '@mmstudio/an000058';\nimport Button from './button';\n\nexport interface IProps<T> {\n\tpage: number;\n\tcount: number;\n\tdata: T[];\n\tq: string;\n}\n\n/**\n * Search with page number in query\n */\nexport default function Search<T>({ initq, pagesize, service, onChange }: {\n\tinitq: string;\n\tpagesize: number;\n\tservice: string;\n\tonChange(v: IProps<T>): void;\n}) {\n\tconst [q, setq] = useState(initq);\n\tconst [, setParams] = useUrlSearchParams({ q }, { q: String });\n\tconst [searching, setsearching] = useState(false);\n\tasync function search() {\n\t\tif (searching) {\n\t\t\treturn;\n\t\t}\n\t\tsetsearching(true);\n\t\ttry {\n\t\t\tconsole.log(router);\n\t\t\tsetParams({ ...router.query, q });\n\t\t\tconst { data, count } = await smartfetch<{ data: T[]; count: number; }>(service, 'get', {\n\t\t\t\tq,\n\t\t\t\tpage: 1,\n\t\t\t\tpagesize\n\t\t\t});\n\t\t\tonChange({\n\t\t\t\tcount,\n\t\t\t\tdata,\n\t\t\t\tpage: 1,\n\t\t\t\tq\n\t\t\t});\n\t\t} finally {\n\t\t\tsetsearching(false);\n\t\t}\n\t}\n\treturn <>\n\t\t<div className='cls001'>\n\t\t\t{searching ? <div className='cls004'><Loading>Searching...</Loading></div> : <input className='cls002' type='search' autoFocus value={q} placeholder='\u8bf7\u8f93\u5165' onChange={(e) => {\n\t\t\t\tsetq(e.target.value);\n\t\t\t}} onKeyPress={(e) => {\n\t\t\t\tif (e.nativeEvent.key === 'Enter') {\n\t\t\t\t\tsearch();\n\t\t\t\t}\n\t\t\t}} />}\n\t\t\t<Button disabled={searching} value='\u641c\u7d22' onClick={search} />\n\t\t</div>\n\t\t<style jsx>{`\n.cls001{\n\tdisplay: flex;\n\tjustify-content: flex-end;\n\tmargin: 1rem;\n}\n.cls002, .cls004{\n\tborder-radius: 0.4rem;\n\tline-height: 1.3rem;\n\tpadding: 0 0.5rem;\n\twidth: 15rem;\n\tmargin-right: 0.5rem;\n\tborder: solid 1px #e0e0e0;\n}\n.cls002:active,.cls002:focus{\n\tborder: solid 1px gray;\n}\n`}</style>\n\t</>;\n}\n",mdxType:"CodeEditor"}),Object(c.a)("h2",null,Object(c.a)("a",b({parentName:"h2"},{href:"../../07/25/1304"}),"Button\u7ec4\u4ef6")))}v.isMDXComponent=!0},asIO:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/codes/2021/05/18/1524",function(){return n("SogW")}])},tzy5:function(t,e,n){!function(t,e){"use strict";function n(t){return(n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function c(t,e){return i(t)||s(t,e)||u(t,e)||f()}function i(t){if(Array.isArray(t))return t}function s(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,a=!1,o=void 0;try{for(var c,i=t[Symbol.iterator]();!(r=(c=i.next()).done)&&(n.push(c.value),!e||n.length!==e);r=!0);}catch(s){a=!0,o=s}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}}function u(t,e){if(t){if("string"===typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function f(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=u(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,i=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return c=t.done,t},e:function(t){i=!0,o=t},f:function(){try{c||null==n.return||n.return()}finally{if(i)throw o}}}}e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var h=function(){},m={popstate:[]},y={URL:function(){this.searchParams={set:h,append:h,delete:h}},location:{href:"",search:""},history:{pushState:h},fireEvent:function(t){m[t].forEach((function(t){t()}))},addEventListener:function(t,e){m[t].push(e)},removeEventListener:function(t,e){var n=m[t],r=n.findIndex((function(t){return t===e}));n.splice(r,1)}};function d(){return"undefined"!==typeof window?window:y}var b=[Number,String,Boolean,Date];function g(t){var e=new(0,d().URL)(d().location.href);return Object.keys(t).forEach((function(r){var a=t[r];null!==a&&void 0!==a?Array.isArray(a)?(e.searchParams.delete(r),a.forEach((function(t){e.searchParams.append(r,t)}))):a instanceof Date?isNaN(a.getTime())||e.searchParams.set(r,a.toISOString()):"object"===n(a)?e.searchParams.set(r,JSON.stringify(a)):e.searchParams.set(r,a):e.searchParams.delete(r)})),e}function v(t){return Array.isArray(t)&&t.length>0&&t.every((function(t){return"number"===typeof t||"string"===typeof t||"boolean"===typeof t}))}function O(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Object.values(t).every((function(t){return b.includes(t)||v(t)||"function"===typeof t})))throw new Error("Unsupported param types. Must be one of [".concat(b.map((function(t){return t.name})).join(", "),"]"))}function j(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;n&&O(n);var r=c(e.useState(),2)[1],a=d().location.search,i=e.useMemo((function(){return new URLSearchParams(a)}),[a]),s=e.useMemo((function(){var e,r=[],a=p(i);try{for(a.s();!(e=a.n()).done;){var s=e.value;r.push({key:s[0],value:s[1]})}}catch(l){a.e(l)}finally{a.f()}r=r.reduce((function(t,e){return(t[e.key]=t[e.key]||[]).push(e),t}),{}),r=Object.keys(r).map((function(t){var e=r[t];return 1===e.length?[t,e[0].value]:[t,e.map((function(t){return t.value}))]}));var u=o({},t);return r.forEach((function(e){var r=c(e,2),a=r[0],o=r[1];u[a]=w(a,o,n,t)})),u}),[i]);function u(t){var e=g(t);d().location.search!==e.search&&d().history.pushState({},"",e),i.toString()!==e.searchParams.toString()&&r({})}e.useEffect((function(){u(o(o({},t),s))}),[s]);var l=function(t){u(t)};return e.useEffect((function(){var t=function(){r({})};return d().addEventListener("popstate",t),function(){d().removeEventListener("popstate",t)}}),[]),[s,l]}var S={true:!0,false:!1};function w(t,e,n,r){if(!n)return e;var a=n[t],o=void 0===e?r[t]:e;return a===Number?Number(o):a===Boolean?S[o]:a===Date?new Date(o):Array.isArray(a)?a.find((function(t){return t==o}))||r[t]:"function"===typeof a?a(o):o}t.useUrlSearchParams=j,Object.defineProperty(t,"__esModule",{value:!0})}(e,n("q1tI"))}},[["asIO",0,1,8,2,3,4,5,6,7]]]);